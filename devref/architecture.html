<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Software Architect - Network Analysis and Data Integration (NADI)</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Network Analysis and Data Integration (NADI)</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="software-architecture"><a class="header" href="#software-architecture">Software Architecture</a></h1>
<p>NADI System consists of multiple components. The top-most division is in the GIS component and the DSL component.</p>
<h2 id="nadi-gis"><a class="header" href="#nadi-gis">NADI GIS</a></h2>
<p>This is the GIS component that helps with network detection, dealing with GIS files, and other utilities.</p>
<p><a href="https://github.com/Nadi-System/nadi-gis">NADI GIS repository</a> contains 3 important components:</p>
<h3 id="cli_tool"><a class="header" href="#cli_tool"><code>cli_tool</code></a></h3>
<p>This contains the CLI for the NADI GIS tool (this compiles to generate <code>nadi-gis</code> binary). The <code>main.rs</code> file contains the code for the CLI, with files inside it providing data types, or code for the subcommands.</p>
<p>Currently it has the following subcommands:</p>
<div class="table-wrapper"><table><thead><tr><th>Command</th><th>File</th><th>Description</th></tr></thead><tbody>
<tr><td><code>nid</code></td><td><code>nid.rs</code></td><td>Download the National Inventory of Dams dataset</td></tr>
<tr><td><code>usgs</code></td><td><code>usgs.rs</code></td><td>Download data from USGS National Hydrography Dataset (NHD+)</td></tr>
<tr><td><code>layers</code></td><td><code>layers.rs</code></td><td>Show list of layers in a GIS file</td></tr>
<tr><td><code>check</code></td><td><code>check.rs</code></td><td>Check the stream network to see outlet, branches, etc</td></tr>
<tr><td><code>order</code></td><td><code>order.rs</code></td><td>Order the streams, adds order attribute to each segment</td></tr>
<tr><td><code>network</code></td><td><code>network.rs</code></td><td>Find the network information from streams file between points</td></tr>
</tbody></table>
</div>
<h3 id="qgis"><a class="header" href="#qgis"><code>qgis</code></a></h3>
<p>This directory contains the NADI QGIS plugin. The plugin is written in Python. This is an experiemental plugin that calls the <code>nadi-gis</code> command line utility with appropriate flags.</p>
<h3 id="nadi_plugin"><a class="header" href="#nadi_plugin"><code>nadi_plugin</code></a></h3>
<p>This is the plugin for NADI DSL that has GIS functions. This compiles into a shared library that can be loaded with NADI System, refer to the nadi plugins documentation on how to load plugins.</p>
<p>The repo contains <code>lib.rs</code> that generates the plugin codes and function available for loading/saving GIS files from the NADI DSL.</p>
<h2 id="nadi-dsl"><a class="header" href="#nadi-dsl">NADI DSL</a></h2>
<p>The NADI DSL also called the Task System consists of components that are related to the programming language that helps with network analysis.</p>
<p>The figure below shows the internal data structure and components that support the NADI DSL execution.</p>
<p><img src="../images/task-architecture.svg" alt="Tasks Architecture" /></p>
<p>The task context is the main runtime environment for the DSL. The Context contains a Network (starts as empty network), functions loaded from the plugins, and the environmental variables. As the DSL is executed Task by Task, the context is modified with mutable functions or assignment operator. For example running a <code>network load_file(...)</code> will load a network from file and save that in the context. When a user runs a <code>node</code> task, the expression/function is run on each node of the network in the current context.</p>
<p>If a user is using NADI from Python library instead of the DSL, then they have access to the Functions, and the data types to generate the Network from files/strings/edges. But they don’t have access to environment variables (they can use python variables), and other syntax advantages of DSL. They also have to run the node functions in loop yourself.
Because of this <code>nadi-py</code> should provide data types from NADI, as well as the functions from the plugins as callable objects in python along side their documentation. We use <code>maturin</code> to generate the python bindings from the rust code.</p>
<p>NADI DSL can also load <code>nadi_gis</code> plugin that provides the functions to read/write GIS files.</p>
<p><a href="https://github.com/Nadi-System/nadi-system">The NADI DSL repository</a> contains the following components:</p>
<p><img src="../images/architecture.svg" alt="Architecture" /></p>
<h3 id="nadi_plugin-1"><a class="header" href="#nadi_plugin-1"><code>nadi_plugin</code></a></h3>
<p>This is crate for proc-macros that <code>nadi_core</code> uses, and can be used to make plugin development easier. This contains the codes for the macros <code>nadi_plugin</code>, <code>env_func</code>, <code>node_func</code>, and <code>network_func</code>. This is re-exported by <code>nadi_core</code> so that it is not used directly by the users.</p>
<h3 id="nadi_core"><a class="header" href="#nadi_core"><code>nadi_core</code></a></h3>
<p>This is the main/core library for NADI System. This contains the data types, APIs and mechanisms for the Plugin system to work.</p>
<h3 id="nadi-cli"><a class="header" href="#nadi-cli"><code>nadi-cli</code></a></h3>
<p>This contains the code for generating the <code>nadi</code> binary. It uses the <code>nadi_core</code> library and just runs the tasks. The binary has command line options (using <code>clap</code>) to run in interactive mode, run a file, show help/code for functions, list functions, etc.</p>
<h3 id="nadi-ide"><a class="header" href="#nadi-ide"><code>nadi-ide</code></a></h3>
<p>This is the main GUI component of NADI system. This provides a graphical interface (written in <code>iced</code>), that has tiling window style panes that each have different components that can display information, or let user interact with it.</p>
<p>This also contains codes to generate custom highlight for the DSL, generate custom widget with network diagram, and such.</p>
<p>The <code>nadi-ide/src/</code> directory contains multiple rust source code files, many of them are for corresponding component of the GUI window.</p>
<h3 id="nadi-serve"><a class="header" href="#nadi-serve"><code>nadi-serve</code></a></h3>
<p>This contains experimental server for running NADI Tasks from a browser. It uses <code>rocket</code> to open a local server, then listens for requests. The requests to run tasks are run independently of one another. The security of letting users run tasks in the server is not well explored, and might need more experimentation before it can be recommended to be used.</p>
<h3 id="extra"><a class="header" href="#extra"><code>extra</code></a></h3>
<p>This directory contains some extra scripts. Currently it contains codes and examples for syntax highlighing task scripts in sublime, typst, latex, HTML (using javascript), etc.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../plugins/nadi_pdf.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../devref/data-structures.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../plugins/nadi_pdf.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../devref/data-structures.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/syntax-highlight.js"></script>



    </div>
    </body>
</html>
